<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Quadro de Post-Its com Login</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      background-color: #fff;
      font-family: Arial, sans-serif;
      overflow: hidden;
    }
    /* Container geral do app */
    #app {
      position: relative;
      width: 100vw;
      height: 100vh;
    }

    /* =========================
       1) ESTILOS DA TELA DE LOGIN
       ========================= */
    #loginContainer {
      position: absolute;
      top: 0; left: 0; right: 0; bottom: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      background: #ffe6ec; /* tom pastel delicado */
      z-index: 2000;      /* fica na frente do restante */
      transition: opacity 0.3s ease, visibility 0.3s ease;
    }
    #loginBox {
      background: #fff;
      border: 1px solid #ffd1dc;
      border-radius: 10px;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
      padding: 20px 30px;
      text-align: center;
      width: 300px;
      max-width: 90%;
    }
    #loginBox h2 {
      margin-top: 0;
      font-family: "Georgia", serif;
      color: #333;
      margin-bottom: 15px;
    }
    #loginBox input {
      width: 100%;
      padding: 10px;
      margin-bottom: 10px;
      border-radius: 5px;
      border: 1px solid #ccc;
      outline: none;
      font-size: 1rem;
    }
    #loginBox button {
      background-color: #FFD1DC;
      border: none;
      border-radius: 5px;
      padding: 10px 20px;
      font-size: 1rem;
      cursor: pointer;
      transition: background-color 0.3s;
      font-family: "Georgia", serif;
    }
    #loginBox button:hover {
      background-color: #ffb9ca;
    }
    #errorMsg {
      color: red;
      font-size: 0.9rem;
      min-height: 1em;
      margin-bottom: 5px;
    }

    /* =========================
       2) ESTILOS DA ÁREA DE POST-ITS
       ========================= */
    /* Oculta o container até logar */
    #postItContainer {
      width: 100%;
      height: 100%;
      display: none; /* escondido inicialmente */
    }

    /* Botão de adição (+) */
    #addButton {
      position: fixed;
      top: 20px;
      right: 20px;
      background-color: #BAFFC9;
      border: none;
      border-radius: 50%;
      width: 50px;
      height: 50px;
      font-size: 2rem;
      color: #fff;
      cursor: pointer;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
      transition: background-color 0.3s;
      z-index: 1000;
    }
    #addButton:hover {
      background-color: #a0e8b1;
    }

    /* Botão para escolher a fonte (T) */
    #fontButton {
      position: fixed;
      top: 80px;
      right: 20px;
      background-color: #FFD1DC;
      border: none;
      border-radius: 50%;
      width: 50px;
      height: 50px;
      font-size: 1.4rem;
      color: #333;
      cursor: pointer;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
      transition: background-color 0.3s;
      z-index: 1000;
      font-family: "Georgia", serif; /* Fonte delicada para o 'T' */
    }
    #fontButton:hover {
      background-color: #ffb9ca;
    }

    /* Paleta de cores */
    #colorPicker {
      position: fixed;
      top: 140px;
      right: 20px;
      background: #fff;
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 5px;
      display: none;
      flex-wrap: wrap;
      gap: 10px;
      z-index: 1000;
    }
    .color-option {
      width: 30px;
      height: 30px;
      border-radius: 50%;
      cursor: pointer;
      border: 1px solid #ccc;
    }

    /* Painel para escolha de fonte global com transição suave */
    #fontPicker {
      position: fixed;
      top: 140px;
      right: 80px;
      background: #ffe6ec;
      padding: 15px;
      border: 1px solid #ffd1dc;
      border-radius: 8px;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
      z-index: 1000;
      transition: opacity 0.3s ease, transform 0.3s ease;
      opacity: 0;
      visibility: hidden;
      transform: translateY(-10px);
    }
    /* Classe para exibir o painel com transição */
    #fontPicker.show {
      opacity: 1;
      visibility: visible;
      transform: translateY(0);
    }

    #fontPicker label {
      display: block;
      margin-bottom: 8px;
      font-family: "Georgia", serif;
      font-size: 0.95rem;
      color: #333;
    }
    #globalFontSelect {
      font-size: 0.9rem;
      border: 1px solid #ccc;
      border-radius: 4px;
      padding: 5px;
      outline: none;
      font-family: 'Arial', sans-serif;
    }
    #globalFontSelect:focus {
      border-color: #ffb9ca;
      outline: none;
    }

    /* Estilo dos post-its */
    .note {
      position: absolute;
      width: 200px;
      min-height: 150px;
      padding: 10px;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
      border-radius: 5px;
      overflow: hidden;
    }
    .note textarea {
      width: 100%;
      height: calc(100% - 40px);
      border: none;
      background: transparent;
      resize: none;
      font-size: 1rem;
      outline: none;
      user-select: text; /* Permite seleção e edição */
    }

    /* Botão de exclusão (delete) – sem preenchimento, apenas o 'X' meio transparente */
    .delete-btn {
      position: absolute;
      top: 5px;
      right: 5px;
      background: transparent;
      color: rgba(255, 255, 255, 0.7);
      border: none;
      font-weight: bold;
      font-size: 1rem;
      cursor: pointer;
      z-index: 10;
    }

    /* Resizer: canto de redimensionamento mais discreto */
    .resizer {
      width: 15px;
      height: 15px;
      position: absolute;
      right: 0;
      bottom: 0;
      cursor: se-resize;
      z-index: 10;
      background: transparent; /* Invisível, mas funcional */
    }
  </style>
</head>
<body>
<div id="app">

  <!-- (A) TELA DE LOGIN -->
  <div id="loginContainer">
    <div id="loginBox">
      <h2>Bem-vindo(a)!</h2>
      <div id="errorMsg"></div>
      <input type="text" id="usernameInput" placeholder="Usuário" />
      <input type="password" id="passwordInput" placeholder="Senha" />
      <button id="loginBtn">Entrar / Registrar</button>
    </div>
  </div>

  <!-- (B) CONTAINER DO QUADRO DE POST-ITS (só aparece após login) -->
  <div id="postItContainer">
    <button id="addButton">+</button>
    <button id="fontButton">T</button>

    <!-- Paleta de cores para criar notas -->
    <div id="colorPicker">
      <!-- Cores originais -->
      <div class="color-option" data-color="#FFB3BA" style="background-color: #FFB3BA;"></div>
      <div class="color-option" data-color="#FFDFBA" style="background-color: #FFDFBA;"></div>
      <div class="color-option" data-color="#FFFFBA" style="background-color: #FFFFBA;"></div>
      <div class="color-option" data-color="#BAFFC9" style="background-color: #BAFFC9;"></div>
      <div class="color-option" data-color="#BAE1FF" style="background-color: #BAE1FF;"></div>
      <!-- Novas cores -->
      <div class="color-option" data-color="#FFD1DC" style="background-color: #FFD1DC;"></div>
      <div class="color-option" data-color="#C1FFC1" style="background-color: #C1FFC1;"></div>
      <div class="color-option" data-color="#C9C9FF" style="background-color: #C9C9FF;"></div>
      <div class="color-option" data-color="#FFFACD" style="background-color: #FFFACD;"></div>
      <div class="color-option" data-color="#E0FFFF" style="background-color: #E0FFFF;"></div>
    </div>

    <!-- Picker de fontes global (com transição) -->
    <div id="fontPicker">
      <label for="globalFontSelect">Escolha a fonte:</label>
      <select id="globalFontSelect">
        <option value="Arial">Arial</option>
        <option value="Comic Sans MS">Comic Sans MS</option>
        <option value="Courier New">Courier New</option>
        <option value="Georgia">Georgia</option>
        <option value="Impact">Impact</option>
        <option value="Lucida Console">Lucida Console</option>
        <option value="Tahoma">Tahoma</option>
        <option value="Trebuchet MS">Trebuchet MS</option>
        <option value="Verdana">Verdana</option>
      </select>
    </div>
  </div>

</div>

<script>
/* =====================================================
   1) SISTEMA DE LOGIN SIMPLES EM LOCALSTORAGE
   ===================================================== */
// Estrutura de dados no localStorage: "users" => {
//   "nomeUsuario": {
//       "password": "1234",
//       "globalFont": "Arial",
//       "notes": [ ... ]
//   },
//   "outroUsuario": {
//       ...
//   }
// }
let users = JSON.parse(localStorage.getItem('users')) || {};

// Usuário logado atualmente (null se não logado)
let currentUser = null;

// Referências aos elementos de login
const loginContainer = document.getElementById('loginContainer');
const errorMsg = document.getElementById('errorMsg');
const usernameInput = document.getElementById('usernameInput');
const passwordInput = document.getElementById('passwordInput');
const loginBtn = document.getElementById('loginBtn');

// Ao clicar em "Entrar / Registrar"
loginBtn.addEventListener('click', () => {
  const username = usernameInput.value.trim();
  const password = passwordInput.value;

  // Validação básica
  if (!username || !password) {
    errorMsg.textContent = "Por favor, preencha usuário e senha.";
    return;
  }

  // Verifica se usuário já existe
  if (!users[username]) {
    // Se não existe, cria novo
    users[username] = {
      password: password,
      globalFont: "Arial", // Fonte padrão
      notes: []
    };
    saveUsers();
    loginSuccess(username);
  } else {
    // Se existe, confere a senha
    if (users[username].password === password) {
      loginSuccess(username);
    } else {
      errorMsg.textContent = "Senha incorreta.";
    }
  }
});

// Salva o objeto "users" no localStorage
function saveUsers() {
  localStorage.setItem('users', JSON.stringify(users));
}

// Função chamada quando o login é bem-sucedido
function loginSuccess(username) {
  currentUser = username;
  errorMsg.textContent = "";
  // Esconde tela de login
  loginContainer.style.display = 'none';
  // Mostra o container de post-its
  document.getElementById('postItContainer').style.display = 'block';
  // Carrega as notas do usuário logado
  loadNotesForUser();
  // Aplica a fonte global que ele já tinha salvo (se existir)
  globalFont = users[currentUser].globalFont || "Arial";
  globalFontSelect.value = globalFont;
  updateAllNotesFont();
}

/* =====================================================
   2) LÓGICA DO QUADRO DE POST-ITS
   ===================================================== */

// Referências dos elementos de post-it
const postItContainer = document.getElementById('postItContainer');
const addButton = document.getElementById('addButton');
const fontButton = document.getElementById('fontButton');
const colorPicker = document.getElementById('colorPicker');
const fontPicker = document.getElementById('fontPicker');
const globalFontSelect = document.getElementById('globalFontSelect');

// Fonte global (por padrão "Arial", mas pode mudar após login)
let globalFont = "Arial";

// Variável para deslocar cada novo post-it
let nextNoteOffset = 0;

/* Botão de adicionar nota */
addButton.addEventListener('click', () => {
  // Abre a paleta de cores
  colorPicker.style.display = 'flex';
  // Fecha o painel de fonte, se estiver aberto
  if (fontPicker.classList.contains('show')) {
    fontPicker.classList.remove('show');
  }
});

/* Botão de escolher fonte (T) */
fontButton.addEventListener('click', () => {
  // Fecha a paleta de cores, se estiver aberta
  colorPicker.style.display = 'none';
  // Exibe/oculta o painel de fonte com animação
  fontPicker.classList.toggle('show');
});

/* Ao mudar a fonte global no select */
globalFontSelect.addEventListener('change', (e) => {
  globalFont = e.target.value;
  // Atualiza o campo no objeto do usuário atual
  users[currentUser].globalFont = globalFont;
  saveUsers();
  // Aplica a fonte em todas as notas
  updateAllNotesFont();
});

/* Cores disponíveis para criar notas */
document.querySelectorAll('.color-option').forEach(option => {
  option.addEventListener('click', function() {
    const color = this.getAttribute('data-color');
    createNote(color);
    colorPicker.style.display = 'none';
  });
});

/* Aplica a fonte global em todas as notas já na tela */
function updateAllNotesFont() {
  const allTextAreas = document.querySelectorAll('.note textarea');
  allTextAreas.forEach(ta => {
    ta.style.fontFamily = globalFont;
  });
}

/* Cria uma nova nota */
function createNote(color, id, content, x, y, width, height) {
  // Se não recebeu id, é uma nota nova
  const noteId = id || generateId();

  // Se for nova, definimos posição deslocada para não sobrepor
  const leftPos = (x !== undefined) ? x : (50 + nextNoteOffset) + 'px';
  const topPos  = (y !== undefined) ? y : (50 + nextNoteOffset) + 'px';

  // Incrementa o offset para a próxima nota
  if (x === undefined && y === undefined) {
    nextNoteOffset += 30;
  }

  const noteDiv = document.createElement('div');
  noteDiv.className = 'note';
  noteDiv.style.backgroundColor = color;
  noteDiv.setAttribute('data-id', noteId);
  noteDiv.style.left = leftPos;
  noteDiv.style.top = topPos;
  noteDiv.style.width = width || '200px';
  noteDiv.style.height = height || '150px';

  // Botão de exclusão
  const deleteBtn = document.createElement('button');
  deleteBtn.className = 'delete-btn';
  deleteBtn.textContent = 'X';
  deleteBtn.addEventListener('click', (e) => {
    e.stopPropagation();
    postItContainer.removeChild(noteDiv);
    // Remove do array de notas do usuário atual
    users[currentUser].notes = users[currentUser].notes.filter(n => n.id !== noteId);
    saveUsers();
  });
  noteDiv.appendChild(deleteBtn);

  // Área de texto
  const textarea = document.createElement('textarea');
  textarea.value = content || '';
  // Aplica a fonte global
  textarea.style.fontFamily = globalFont;

  // Ao digitar, atualiza o conteúdo no localStorage
  textarea.addEventListener('input', () => {
    updateNote(
      noteId,
      noteDiv.style.left,
      noteDiv.style.top,
      color,
      textarea.value,
      noteDiv.style.width,
      noteDiv.style.height
    );
  });
  noteDiv.appendChild(textarea);

  // Drag and drop para mover a nota
  noteDiv.addEventListener('mousedown', mouseDown);
  function mouseDown(e) {
    // Se clicar no textarea ou resizer, não arrasta
    if (
      e.target.tagName.toLowerCase() === 'textarea' ||
      e.target.classList.contains('resizer')
    ) {
      return;
    }
    e.preventDefault();
    let shiftX = e.clientX - noteDiv.getBoundingClientRect().left;
    let shiftY = e.clientY - noteDiv.getBoundingClientRect().top;

    function moveAt(pageX, pageY) {
      noteDiv.style.left = pageX - shiftX + 'px';
      noteDiv.style.top = pageY - shiftY + 'px';
    }

    function onMouseMove(e) {
      moveAt(e.pageX, e.pageY);
    }
    document.addEventListener('mousemove', onMouseMove);

    document.addEventListener('mouseup', function mouseUp() {
      document.removeEventListener('mousemove', onMouseMove);
      document.removeEventListener('mouseup', mouseUp);
      updateNote(
        noteId,
        noteDiv.style.left,
        noteDiv.style.top,
        color,
        textarea.value,
        noteDiv.style.width,
        noteDiv.style.height
      );
    });
  }
  noteDiv.ondragstart = function() {
    return false;
  };

  // Resizer para redimensionar
  const resizer = document.createElement('div');
  resizer.className = 'resizer';
  resizer.addEventListener('mousedown', initResize);
  noteDiv.appendChild(resizer);

  function initResize(e) {
    e.stopPropagation();
    window.addEventListener('mousemove', Resize);
    window.addEventListener('mouseup', stopResize);
  }

  function Resize(e) {
    const rect = noteDiv.getBoundingClientRect();
    let newWidth = e.clientX - rect.left;
    let newHeight = e.clientY - rect.top;
    // Define valores mínimos
    if (newWidth < 150) newWidth = 150;
    if (newHeight < 100) newHeight = 100;
    noteDiv.style.width = newWidth + 'px';
    noteDiv.style.height = newHeight + 'px';
  }

  function stopResize() {
    window.removeEventListener('mousemove', Resize);
    window.removeEventListener('mouseup', stopResize);
    updateNote(
      noteId,
      noteDiv.style.left,
      noteDiv.style.top,
      color,
      textarea.value,
      noteDiv.style.width,
      noteDiv.style.height
    );
  }

  postItContainer.appendChild(noteDiv);

  // Se a nota for nova, adiciona ao array do usuário
  if (!id) {
    users[currentUser].notes.push({
      id: noteId,
      color: color,
      content: textarea.value,
      x: noteDiv.style.left,
      y: noteDiv.style.top,
      width: noteDiv.style.width,
      height: noteDiv.style.height
    });
    saveUsers();
  }
}

/* Gera um ID único para cada nota */
function generateId() {
  return 'note-' + Date.now() + '-' + Math.floor(Math.random() * 1000);
}

/* Atualiza os dados de uma nota no array do usuário atual */
function updateNote(id, x, y, color, content, width, height) {
  let userNotes = users[currentUser].notes;
  userNotes = userNotes.map(note => {
    if (note.id === id) {
      return { id, color, content, x, y, width, height };
    }
    return note;
  });
  users[currentUser].notes = userNotes;
  saveUsers();
}

/* Carrega as notas do usuário atual */
function loadNotesForUser() {
  // Limpa qualquer nota que esteja na tela
  document.querySelectorAll('.note').forEach(n => n.remove());

  // Reseta offset para que notas novas fiquem deslocadas
  nextNoteOffset = 0;

  // Carrega as notas do usuário
  const userNotes = users[currentUser].notes || [];
  userNotes.forEach(note => {
    createNote(
      note.color,
      note.id,
      note.content,
      note.x,
      note.y,
      note.width,
      note.height
    );
  });
}
</script>
</body>
</html>
